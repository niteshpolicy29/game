var $=Object.defineProperty;var Q=(x,e,a)=>e in x?$(x,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):x[e]=a;var V=(x,e,a)=>Q(x,typeof e!="symbol"?e+"":e,a);import{P as l}from"./phaser-0RJB29YE.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function a(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=a(t);fetch(t.href,s)}})();const q={type:l.AUTO,width:1920,height:1080,parent:"game-container",backgroundColor:"#0a0a0f",render:{antialias:!0,pixelArt:!1,roundPixels:!1,powerPreference:"high-performance",mipmapFilter:"LINEAR_MIPMAP_LINEAR"},physics:{default:"arcade",arcade:{gravity:{y:1920},debug:!1}},scale:{mode:l.Scale.WIDTH_CONTROLS_HEIGHT,autoCenter:l.Scale.CENTER_BOTH,width:1920,parent:"game-container"}},Y={maxSpeed:480,acceleration:1440,jumpVelocity:-960};class Z extends l.Scene{constructor(){super({key:"TutorialScene"})}preload(){this.load.image("background","/bg.png")}create(){const e=this.cameras.main.centerX;this.add.rectangle(e,540,this.cameras.main.width,this.cameras.main.height,657935),this.add.text(e,60,"HOW TO PLAY",{fontFamily:"October Crow, cursive",fontSize:"64px",fill:"#ff6600",stroke:"#000000",strokeThickness:6}).setOrigin(.5),this.add.text(e,120,"Master the Three Forms",{fontFamily:"Griffy, cursive",fontSize:"28px",fill:"#ffaa00",fontStyle:"italic"}).setOrigin(.5);const t=e-500,s=e,n=e+500,r=200;this.createFormTip(t,r,"CANDY BALL","#ff7700",`Press E to toggle

Fast movement
Normal jump
Best for speed`),this.createFormTip(s,r,"MARSHMALLOW","#fff8f0",`Press E to toggle

Slow movement
Cannot jump
Floats on water`),this.createFormTip(n,r,"JELLY","#44ff44",`Press Q to toggle

Auto-hops always
W = BIG jump
W in air = fast-fall`);const o=550;this.add.text(e,o,"CONTROLS",{fontFamily:"Griffy, cursive",fontSize:"32px",fill:"#ffffff",fontStyle:"bold"}).setOrigin(.5),this.add.text(e,o+50,"Move: A/D or ←/→     Jump: W/Space/↑     Forms: E (Candy/Marshmallow)  Q (Jelly)",{fontFamily:"Griffy, cursive",fontSize:"22px",fill:"#aaaaaa"}).setOrigin(.5),this.add.text(e,o+110,"You have 4 lives • No checkpoints - complete in one run!",{fontFamily:"Griffy, cursive",fontSize:"24px",fill:"#00ff00"}).setOrigin(.5);const d=this.add.text(e,1e3,"Press SPACE to Start Game",{fontFamily:"Griffy, cursive",fontSize:"42px",fill:"#ff6600",fontStyle:"bold",stroke:"#000000",strokeThickness:4});d.setOrigin(.5),this.add.text(e,950,"Press ESC to return to menu",{fontFamily:"Griffy, cursive",fontSize:"20px",fill:"#888888"}).setOrigin(.5),this.tweens.add({targets:d,alpha:.3,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.input.keyboard.once("keydown-SPACE",()=>{this.scene.start("GameScene")}),this.input.keyboard.once("keydown-ESC",()=>{this.scene.start("MenuScene")})}createFormTip(e,a,i,t,s){this.add.rectangle(e,a,280,45,l.Display.Color.HexStringToColor(t).color,.25).setStrokeStyle(2,l.Display.Color.HexStringToColor(t).color,.8),this.add.text(e,a,i,{fontFamily:"Griffy, cursive",fontSize:"26px",fill:t,fontStyle:"bold",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.add.text(e,a+50,s,{fontFamily:"Griffy, cursive",fontSize:"18px",fill:"#dddddd",align:"center",lineSpacing:6}).setOrigin(.5,0)}}class b{static getMusicVolume(){const e=localStorage.getItem(this.MUSIC_VOLUME_KEY);return e!==null?parseFloat(e):.3}static getSFXVolume(){const e=localStorage.getItem(this.SFX_VOLUME_KEY);return e!==null?parseFloat(e):.5}static setMusicVolume(e){localStorage.setItem(this.MUSIC_VOLUME_KEY,e.toString())}static setSFXVolume(e){localStorage.setItem(this.SFX_VOLUME_KEY,e.toString())}}V(b,"MUSIC_VOLUME_KEY","musicVolume"),V(b,"SFX_VOLUME_KEY","sfxVolume");class ee extends l.Scene{constructor(){super({key:"BootScene"})}preload(){this.add.text(this.cameras.main.centerX,this.cameras.main.centerY,"Loading...",{fontSize:"24px",fill:"#fff"}).setOrigin(.5),this.load.image("bg-layer-1","/game area background/1.png"),this.load.image("bg-layer-2","/game area background/2.png"),this.load.image("bg-layer-3","/game area background/3.png"),this.load.image("bg-layer-4","/game area background/4.png"),this.load.image("bg-layer-5","/game area background/5.png"),this.load.audio("jump-sound","/audio/jump-sound.mp3"),this.load.audio("game-over-sound","/audio/game-over.mp3"),this.load.audio("bgm","/audio/bgm.mp3"),this.load.audio("victory-sound","/audio/victory.mp3"),this.load.audio("death-sound","/audio/losses one live.mp3")}create(){if(!this.sound.get("bgm")){const e=b.getMusicVolume();this.sound.add("bgm",{loop:!0,volume:e}).play()}this.scene.start("MenuScene")}}class te extends l.Scene{constructor(){super({key:"MenuScene"})}preload(){this.load.image("menu-bg","/start png/starting game page.png")}create(){const e=this.cameras.main.centerX,a=this.cameras.main.centerY;this.add.image(e,a,"menu-bg").setDisplaySize(this.cameras.main.width,this.cameras.main.height),this.add.rectangle(e,a,this.cameras.main.width,this.cameras.main.height,0,.5);const t=this.add.text(e,a-200,"NIGHTMELLOW",{fontFamily:"October Crow, cursive",fontSize:"96px",fill:"#ff6600"});t.setOrigin(.5),t.setShadow(5,5,"#000000",10),this.add.text(e,a-100,"ESCAPE THE DARKNESS",{fontFamily:"Griffy, cursive",fontSize:"48px",fill:"#8b00ff",fontStyle:"italic"}).setOrigin(.5),this.createButton(e,a+20,"START GAME",()=>{this.scene.start("IntroScene")}),this.createButton(e,a+100,"HOW TO PLAY",()=>{this.scene.start("TutorialScene")}),this.createButton(e,a+180,"OPTIONS",()=>{this.scene.start("OptionsScene")}),this.add.text(e,this.cameras.main.height-40,"Built with Phaser 3",{fontFamily:"Griffy, cursive",fontSize:"20px",fill:"#666666"}).setOrigin(.5)}createButton(e,a,i,t){const r=this.add.rectangle(e,a,400,60,0,.7);r.setStrokeStyle(3,16737792);const o=this.add.text(e,a,i,{fontFamily:"Griffy, cursive",fontSize:"32px",fill:"#ff6600",fontStyle:"bold"});return o.setOrigin(.5),r.setInteractive({useHandCursor:!0}),r.on("pointerover",()=>{r.setFillStyle(16737792,.3),o.setScale(1.1)}),r.on("pointerout",()=>{r.setFillStyle(0,.7),o.setScale(1)}),r.on("pointerdown",()=>{r.setFillStyle(16737792,.5),o.setScale(.95)}),r.on("pointerup",()=>{r.setFillStyle(16737792,.3),o.setScale(1.1),t()}),{bg:r,text:o}}}class ie extends l.Scene{constructor(){super({key:"OptionsScene"})}create(){const e=this.cameras.main.centerX,a=this.cameras.main.centerY;this.add.rectangle(e,a,this.cameras.main.width,this.cameras.main.height,657935,.95);const i=this.add.text(e,100,"OPTIONS",{fontFamily:"October Crow, cursive",fontSize:"72px",fill:"#ff6600"});i.setOrigin(.5),i.setShadow(5,5,"#000000",10),this.add.text(e,a-100,"AUDIO SETTINGS",{fontFamily:"Griffy, cursive",fontSize:"42px",fill:"#ffaa00",fontStyle:"bold"}).setOrigin(.5);const s=b.getMusicVolume(),n=b.getSFXVolume();this.createVolumeSlider(e,a-20,"Music Volume","music",s),this.createVolumeSlider(e,a+60,"SFX Volume","sfx",n),this.createButton(e,this.cameras.main.height-100,"BACK TO MENU",()=>{this.scene.start("MenuScene")}),this.add.text(e,this.cameras.main.height-40,"Press ESC to return to menu",{fontFamily:"Griffy, cursive",fontSize:"20px",fill:"#888888"}).setOrigin(.5),this.input.keyboard.once("keydown-ESC",()=>{this.scene.start("MenuScene")})}createVolumeSlider(e,a,i,t,s){this.add.text(e-350,a,i+":",{fontFamily:"Griffy, cursive",fontSize:"28px",fill:"#ffffff"}).setOrigin(0,.5);const r=300,o=20,y=e+50;this.add.rectangle(y,a,r,o,3355443).setStrokeStyle(2,16737792);const c=y-r/2,d=r*s,f=this.add.rectangle(c,a,d,o,16737792);f.setOrigin(0,.5);const g=this.add.text(e+220,a,Math.round(s*100)+"%",{fontFamily:"Griffy, cursive",fontSize:"24px",fill:"#ffaa00"});g.setOrigin(0,.5);const m=this.add.rectangle(y,a,r,o*3,0,0);m.setInteractive({draggable:!1,useHandCursor:!0});let u=!1;m.on("pointerdown",p=>{u=!0,this.updateSlider(p,y,r,f,g,t)}),m.on("pointermove",p=>{u&&this.updateSlider(p,y,r,f,g,t)}),m.on("pointerup",()=>{u=!1}),m.on("pointerout",()=>{u=!1})}updateSlider(e,a,i,t,s,n){const r=a-i/2,o=a+i/2,y=e.x+this.cameras.main.scrollX,h=l.Math.Clamp(y,r,o),c=l.Math.Clamp((h-r)/i,0,1),d=i*c;if(t.width=d,t.x=r,s.setText(Math.round(c*100)+"%"),n==="music"){b.setMusicVolume(c);const f=this.sound.get("bgm");f&&f.setVolume(c)}else n==="sfx"&&b.setSFXVolume(c)}createButton(e,a,i,t){const r=this.add.rectangle(e,a,400,60,0,.7);r.setStrokeStyle(3,16737792);const o=this.add.text(e,a,i,{fontFamily:"Griffy, cursive",fontSize:"32px",fill:"#ff6600",fontStyle:"bold"});return o.setOrigin(.5),r.setInteractive({useHandCursor:!0}),r.on("pointerover",()=>{r.setFillStyle(16737792,.3),o.setScale(1.1)}),r.on("pointerout",()=>{r.setFillStyle(0,.7),o.setScale(1)}),r.on("pointerdown",()=>{r.setFillStyle(16737792,.5),o.setScale(.95)}),r.on("pointerup",()=>{r.setFillStyle(16737792,.3),o.setScale(1.1),t()}),{bg:r,text:o}}}class se extends l.Scene{constructor(){super({key:"IntroScene"})}create(){const e=this.cameras.main.centerX,a=this.cameras.main.centerY;this.add.rectangle(e,a,this.cameras.main.width,this.cameras.main.height,657935,1),this.storyLines=["On Halloween night, when monsters roam freely…","…one brave candy rolls into the darkness.","Its mission is simple — deliver treats to the kids before it's too late.","But bats, gaps, ghosts, and cursed waters stand in the way.","Transform, survive, and complete the night of destiny."],this.currentLine=0,this.canSkip=!1,this.storyText=this.add.text(e,a,"",{fontFamily:"Griffy, cursive",fontSize:"36px",fill:"#ffaa00",align:"center",wordWrap:{width:1400}}),this.storyText.setOrigin(.5),this.storyText.setAlpha(0),this.skipText=this.add.text(e,this.cameras.main.height-80,"Press SPACE to skip",{fontFamily:"Griffy, cursive",fontSize:"24px",fill:"#888888"}),this.skipText.setOrigin(.5),this.tweens.add({targets:this.skipText,alpha:.3,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.showNextLine(),this.input.keyboard.on("keydown-SPACE",()=>{this.canSkip&&this.skipIntro()})}showNextLine(){if(this.currentLine>=this.storyLines.length){this.time.delayedCall(1500,()=>{this.scene.start("GameScene",{level:1,lives:4})});return}this.canSkip=!0,this.tweens.add({targets:this.storyText,alpha:0,duration:300,onComplete:()=>{this.storyText.setText(this.storyLines[this.currentLine]),this.tweens.add({targets:this.storyText,alpha:1,duration:800,ease:"Sine.easeIn",onComplete:()=>{this.time.delayedCall(2500,()=>{this.currentLine++,this.showNextLine()})}})}})}skipIntro(){this.tweens.killAll(),this.time.removeAllEvents(),this.scene.start("GameScene",{level:1,lives:4})}}const F={platforms:[{x:350,y:1044,width:700,height:72},{x:1330,y:1044,width:480,height:72},{x:2330,y:1044,width:620,height:72},{x:3800,y:1044,width:550,height:72},{x:4530,y:1044,width:700,height:72},{x:6210,y:1044,width:450,height:72},{x:7420,y:1044,width:800,height:72},{x:850,y:880,width:160,height:48},{x:1050,y:820,width:140,height:48},{x:1920,y:850,width:180,height:48},{x:2100,y:760,width:150,height:48},{x:2280,y:820,width:170,height:48},{x:2e3,y:680,width:130,height:48},{x:4400,y:850,width:120,height:48},{x:5350,y:820,width:180,height:48},{x:5580,y:740,width:160,height:48},{x:5820,y:680,width:140,height:48},{x:5450,y:880,width:170,height:48},{x:5700,y:600,width:150,height:48},{x:5950,y:760,width:190,height:48},{x:6100,y:850,width:160,height:48}],playerStart:{x:240,y:900},goal:{x:7650,y:850},checkpoints:[{x:2700,y:950},{x:5400,y:950}],enemies:[{x:1450,y:900,patrolStart:1280,patrolEnd:1680},{x:2100,y:680,patrolStart:2020,patrolEnd:2180},{x:2550,y:900,patrolStart:2380,patrolEnd:2820},{x:4800,y:900,patrolStart:4600,patrolEnd:5100},{x:5700,y:520,patrolStart:5620,patrolEnd:5780},{x:6350,y:900,patrolStart:6250,patrolEnd:6550}],waterAreas:[{x:3082.5,y:1044,width:885,height:48},{x:6727.5,y:1044,width:585,height:48}],worldBounds:{width:8220,height:1080}},ae={platforms:[{x:350,y:1044,width:600,height:72},{x:1250,y:1044,width:550,height:72},{x:2345,y:1044,width:480,height:72},{x:3760,y:1044,width:620,height:72},{x:4700,y:1044,width:650,height:72},{x:6450,y:1044,width:500,height:72},{x:7630,y:1044,width:750,height:72},{x:800,y:900,width:150,height:48},{x:980,y:820,width:160,height:48},{x:1150,y:880,width:140,height:48},{x:1680,y:850,width:170,height:48},{x:1880,y:740,width:150,height:48},{x:2080,y:820,width:180,height:48},{x:1780,y:680,width:140,height:48},{x:2250,y:900,width:160,height:48},{x:4460,y:880,width:140,height:48},{x:5480,y:850,width:170,height:48},{x:5680,y:760,width:150,height:48},{x:5880,y:680,width:160,height:48},{x:6080,y:740,width:140,height:48},{x:5580,y:920,width:180,height:48},{x:5780,y:600,width:150,height:48},{x:5980,y:820,width:170,height:48},{x:6180,y:880,width:160,height:48}],playerStart:{x:240,y:900},goal:{x:7800,y:850},checkpoints:[],enemies:[{x:1400,y:900,patrolStart:1250,patrolEnd:1650},{x:1880,y:660,patrolStart:1800,patrolEnd:1960},{x:2500,y:900,patrolStart:2350,patrolEnd:2750},{x:4900,y:900,patrolStart:4750,patrolEnd:5100},{x:5780,y:520,patrolStart:5700,patrolEnd:5860},{x:6080,y:660,patrolStart:6e3,patrolEnd:6160},{x:6600,y:900,patrolStart:6500,patrolEnd:6850}],waterAreas:[{x:3017.5,y:1044,width:865,height:48},{x:6977.5,y:1044,width:555,height:48}],worldBounds:{width:8400,height:1080}},re={platforms:[{x:350,y:1044,width:700,height:72},{x:1225,y:1044,width:550,height:72},{x:2295,y:1044,width:500,height:72},{x:3545,y:1044,width:600,height:72},{x:4625,y:1044,width:550,height:72},{x:5855,y:1044,width:500,height:72},{x:7205,y:1044,width:1200,height:72},{x:850,y:900,width:150,height:48},{x:1020,y:850,width:140,height:48},{x:1680,y:880,width:150,height:48},{x:1840,y:820,width:140,height:48},{x:2e3,y:860,width:160,height:48},{x:2160,y:900,width:140,height:48},{x:4110,y:870,width:150,height:48},{x:4270,y:810,width:140,height:48},{x:4430,y:870,width:150,height:48},{x:5280,y:860,width:150,height:48},{x:5440,y:780,width:140,height:48},{x:5600,y:700,width:160,height:48},{x:5760,y:820,width:150,height:48}],playerStart:{x:240,y:900},goal:{x:7700,y:850},checkpoints:[],enemies:[{x:1350,y:900,patrolStart:1225,patrolEnd:1625},{x:1840,y:740,patrolStart:1760,patrolEnd:1920},{x:2420,y:900,patrolStart:2295,patrolEnd:2645},{x:3700,y:900,patrolStart:3545,patrolEnd:3945},{x:4780,y:900,patrolStart:4625,patrolEnd:5025},{x:5600,y:620,patrolStart:5520,patrolEnd:5680},{x:6e3,y:900,patrolStart:5855,patrolEnd:6205},{x:7380,y:900,patrolStart:7205,patrolEnd:7605},{x:7650,y:900,patrolStart:7500,patrolEnd:7800}],waterAreas:[{x:2895,y:1044,width:700,height:48},{x:6355,y:1044,width:500,height:48}],worldBounds:{width:8400,height:1080}},ne={platforms:[{x:350,y:1044,width:700,height:72},{x:1375,y:1044,width:550,height:72},{x:2775,y:1044,width:500,height:72},{x:4225,y:1044,width:600,height:72},{x:5545,y:1044,width:550,height:72},{x:6975,y:1044,width:500,height:72},{x:8475,y:1044,width:1400,height:72},{x:850,y:880,width:150,height:48},{x:1010,y:820,width:140,height:48},{x:1170,y:860,width:160,height:48},{x:2050,y:870,width:150,height:48},{x:2210,y:800,width:140,height:48},{x:2370,y:730,width:160,height:48},{x:2530,y:820,width:150,height:48},{x:2690,y:880,width:140,height:48},{x:4710,y:870,width:150,height:48},{x:4870,y:810,width:140,height:48},{x:5030,y:750,width:160,height:48},{x:5190,y:830,width:150,height:48},{x:6380,y:860,width:150,height:48},{x:6540,y:790,width:140,height:48},{x:6700,y:720,width:160,height:48},{x:6860,y:810,width:150,height:48}],playerStart:{x:240,y:900},goal:{x:9e3,y:850},checkpoints:[],enemies:[{x:1500,y:900,patrolStart:1375,patrolEnd:1775},{x:2210,y:720,patrolStart:2130,patrolEnd:2290},{x:2900,y:900,patrolStart:2775,patrolEnd:3125},{x:4400,y:900,patrolStart:4225,patrolEnd:4625},{x:5700,y:900,patrolStart:5545,patrolEnd:5945},{x:6540,y:710,patrolStart:6460,patrolEnd:6620},{x:7150,y:900,patrolStart:6975,patrolEnd:7375},{x:8700,y:900,patrolStart:8475,patrolEnd:8875},{x:9100,y:900,patrolStart:8950,patrolEnd:9250}],waterAreas:[{x:3475,y:1044,width:900,height:48},{x:7500,y:1044,width:550,height:48}],worldBounds:{width:9675,height:1080}};class le{constructor(e,a){this.scene=e,this.platforms=e.physics.add.staticGroup(),this.createPlatforms(a.platforms)}createPlatforms(e){e.forEach((a,i)=>{const t=this.scene.add.rectangle(a.x,a.y,a.width,a.height,2956032);t.setStrokeStyle(4,9109759,.6),this.scene.physics.add.existing(t,!0),this.platforms.add(t)})}setupCollisions(e){this.scene.physics.add.collider(e,this.platforms)}getPlatforms(){return this.platforms}}class oe extends l.Physics.Arcade.Sprite{constructor(e,a,i,t,s){super(e,a,i,null),e.add.existing(this),e.physics.add.existing(this),this.radius=48,this.glowWidth=10,this.baseScale=.25,this.moonX=t||2880,this.moonY=s||216,this.createVisuals(),this.createShine();const n=this.radius*2-8,r=(this.width-n)/2;this.body.setSize(n,n),this.body.setOffset(r,r),this.body.setCollideWorldBounds(!1),this.body.setMaxVelocity(Y.maxSpeed,2400),this.body.setBounce(0),this.body.setDrag(50,0),this.maxSpeed=Y.maxSpeed,this.acceleration=Y.acceleration,this.jumpVelocity=Y.jumpVelocity,this.friction=720,this.isGrounded=!1,this.wasAirborne=!1,this.landingTween=null,this.jumpBufferTime=0,this.jumpBufferWindow=150,this.currentForm="candy",this.isMarshmallow=!1,this.isJelly=!1,this.marshmallowMaxSpeed=240,this.marshmallowAcceleration=720,this.jellyMaxSpeed=280,this.jellyAcceleration=840,this.jellyJumpVelocity=-1500,this.jellyIdleHopVelocity=-500,this.jellyBounce=.5,this.jellyHopTimer=0,this.jellyHopInterval=800,this.jellyFastFalling=!1,this.waterBobPhase=0,this.waterBobSpeed=.02,this.waterVerticalVelocity=0,this.waterDipAmount=0,this.waterDipRecovery=0,this.inWater=!1,this.justEnteredWater=!1,this.waterEntryVelocity=0,this.createMarshmallowTexture(),this.createJellyTexture(),this.isDead=!1}createVisuals(){const e=this.glowWidth*2,a=this.radius*2+e,i=this.radius+this.glowWidth,t=this.scene.make.graphics({x:0,y:0});t.fillStyle(16742144,1),t.fillCircle(i,i,this.radius),t.fillStyle(16755200,1);for(let s=0;s<5;s++){const n=s*Math.PI*2/5;t.beginPath(),t.arc(i,i,this.radius,n-.2,n+.2,!1),t.arc(i,i,this.radius*.6,n+.2,n-.2,!0),t.closePath(),t.fillPath()}t.fillStyle(13391104,.3),t.fillCircle(i,i+this.radius/3,this.radius*.7),t.fillStyle(16759620,.3),t.fillCircle(i,i-this.radius/3,this.radius*.7),t.lineStyle(this.glowWidth,16755268,.5),t.strokeCircle(i,i,this.radius),t.generateTexture("player-ball",a,a),t.destroy(),this.setTexture("player-ball"),this.setScale(1)}createMarshmallowTexture(){if(this.scene.textures.exists("player-marshmallow"))return;const e=this.glowWidth*2,a=this.radius*2+e,i=this.radius+this.glowWidth,t=this.scene.make.graphics({x:0,y:0});t.fillStyle(16775408,1),t.fillCircle(i,i,this.radius),t.fillStyle(16777215,1),t.fillEllipse(i,i-this.radius*.3,this.radius*.85,this.radius*.4),t.fillStyle(16774638,1),t.fillRect(i-this.radius*.85,i-this.radius*.3,this.radius*1.7,this.radius*.6),t.fillStyle(16115411,1),t.fillEllipse(i,i+this.radius*.3,this.radius*.85,this.radius*.4),t.lineStyle(2,15787740,.3);for(let s=-2;s<=2;s++){const n=i+s*this.radius*.35;t.beginPath(),t.moveTo(n,i-this.radius*.5),t.lineTo(n,i+this.radius*.5),t.strokePath()}t.fillStyle(15259072,.5),t.fillEllipse(i,i+this.radius*.4,this.radius*.7,this.radius*.25),t.fillStyle(16777215,.7),t.fillEllipse(i-this.radius*.2,i-this.radius*.35,this.radius*.4,this.radius*.2),t.lineStyle(this.glowWidth,16775408,.3),t.strokeCircle(i,i,this.radius),t.generateTexture("player-marshmallow",a,a),t.destroy()}createJellyTexture(){if(this.scene.textures.exists("player-jelly"))return;const e=this.glowWidth*2,a=this.radius*2+e,i=this.radius+this.glowWidth,t=this.scene.make.graphics({x:0,y:0});t.fillStyle(4521796,.85),t.fillCircle(i,i,this.radius),t.fillStyle(8978312,.6),t.fillCircle(i,i,this.radius*.7),t.fillStyle(13434828,.8),t.fillCircle(i-this.radius*.3,i-this.radius*.3,this.radius*.3),t.fillStyle(16777215,.6),t.fillCircle(i-this.radius*.35,i-this.radius*.35,this.radius*.15),t.fillStyle(13434828,.5),t.fillCircle(i+this.radius*.4,i+this.radius*.2,this.radius*.2),t.fillStyle(2271778,.4),t.fillEllipse(i,i+this.radius*.4,this.radius*.8,this.radius*.3),t.lineStyle(this.glowWidth,4521796,.5),t.strokeCircle(i,i,this.radius),t.generateTexture("player-jelly",a,a),t.destroy()}update(e,a){this.isDead||((!this._lastScaleCheck||Date.now()-this._lastScaleCheck>100)&&(this._lastScaleCheck=Date.now(),this.scene.tweens.getTweensOf(this).length===0&&(this.scaleX!==1||this.scaleY!==1)&&this.setScale(1,1)),l.Input.Keyboard.JustDown(a.Q)&&this.toggleJelly(),l.Input.Keyboard.JustDown(a.E)&&this.toggleMarshmallow(),e.left.isDown||a.A.isDown?this.moveLeft():e.right.isDown||a.D.isDown?this.moveRight():this.applyFriction(),this.currentForm!=="marshmallow"&&(l.Input.Keyboard.JustDown(e.up)||l.Input.Keyboard.JustDown(e.space)||l.Input.Keyboard.JustDown(a.W))&&this.jump(),this.checkGrounded(),this.updateRoll(),this.currentForm==="marshmallow"?this.applyBuoyancy():this.currentForm==="jelly"&&(this.isGrounded&&(this.jellyFastFalling=!1,this.updateJellyIdleHop()),this.isGrounded||(this.jellyFastFalling?this.applyJellyFastFall():this.applyJellyFloat())))}moveLeft(){const e=this.getCurrentAcceleration();this.body.setAccelerationX(-e)}moveRight(){const e=this.getCurrentAcceleration();this.body.setAccelerationX(e)}getCurrentAcceleration(){return this.currentForm==="marshmallow"?this.marshmallowAcceleration:this.currentForm==="jelly"?this.jellyAcceleration:this.acceleration}getCurrentMaxSpeed(){return this.currentForm==="marshmallow"?this.marshmallowMaxSpeed:this.currentForm==="jelly"?this.jellyMaxSpeed:this.maxSpeed}applyFriction(){const e=this.body.velocity.x;if(Math.abs(e)>3){const a=e>0?-this.friction:this.friction;this.body.setAccelerationX(a)}else this.body.setVelocityX(0),this.body.setAccelerationX(0)}jump(){if(this.currentForm==="jelly"){const e=this.body.touching.down||this.body.blocked.down,a=this.body.velocity.y>-100&&this.body.velocity.y<50;e||a&&this.isGrounded?(this.body.setVelocityY(this.jellyJumpVelocity),this.isGrounded=!1,this.wasAirborne=!0,this.jumpBufferTime=0,this.jellyHopTimer=Date.now(),this.jellyFastFalling=!1,this.scene.sound.play("jump-sound",{volume:b.getSFXVolume()}),this.scene.tweens.killTweensOf(this),this.setScale(1,1)):e||(this.jellyFastFalling=!0,this.jumpBufferTime=Date.now(),this.body.velocity.y<0&&this.body.setVelocityY(0))}else this.body.touching.down||this.body.blocked.down?(this.body.setVelocityY(this.jumpVelocity),this.isGrounded=!1,this.wasAirborne=!0,this.jumpBufferTime=0,this.scene.sound.play("jump-sound",{volume:b.getSFXVolume()})):this.jumpBufferTime=Date.now()}checkGrounded(){const e=this.isGrounded,a=this.body.velocity.y;if(this.isGrounded=this.body.touching.down||this.body.blocked.down,this.isGrounded&&this.jumpBufferTime>0)if(Date.now()-this.jumpBufferTime<this.jumpBufferWindow){const t=this.currentForm==="jelly"?this.jellyJumpVelocity:this.jumpVelocity;this.body.setVelocityY(t),this.jumpBufferTime=0,this.wasAirborne=!0,this.scene.sound.play("jump-sound",{volume:b.getSFXVolume()}),this.currentForm==="jelly"&&(this.jellyHopTimer=Date.now());return}else this.jumpBufferTime=0;this.isGrounded&&!e&&this.wasAirborne&&this.onLanding(a),this.isGrounded?this.wasAirborne=!1:this.wasAirborne=!0}onLanding(e){this.scene.tweens.killTweensOf(this),this.setScale(1,1)}createShine(){const e=this.scene.make.graphics({x:0,y:0});e.fillStyle(16777215,.6),e.fillCircle(50,50,15),e.fillStyle(16777215,.9),e.fillCircle(50,50,7),e.generateTexture("ball-shine",100,100),e.destroy(),this.shine=this.scene.add.sprite(this.x,this.y,"ball-shine"),this.shine.setDepth(this.depth+1),this.shine.setScale(.8)}transformTo(e){this.currentForm,this.currentForm=e,this.scene.tweens.killTweensOf(this),this.setScale(1,1),this.isMarshmallow=e==="marshmallow",this.isJelly=e==="jelly",e==="candy"?(this.setTexture("player-ball"),this.body.setMaxVelocity(this.maxSpeed,2400),this.body.setBounce(0)):e==="marshmallow"?(this.setTexture("player-marshmallow"),this.body.setMaxVelocity(this.marshmallowMaxSpeed,2400),this.body.setBounce(0)):e==="jelly"&&(this.setTexture("player-jelly"),this.body.setMaxVelocity(this.jellyMaxSpeed,2400),this.body.setBounce(this.jellyBounce),this.jellyHopTimer=Date.now());const a=e==="candy"?16755200:e==="marshmallow"?16777215:4521796;for(let i=0;i<10;i++){const t=i*Math.PI*2/10,s=this.scene.add.circle(this.x+Math.cos(t)*30,this.y+Math.sin(t)*30,l.Math.Between(4,8),a,.8);this.scene.tweens.add({targets:s,x:s.x+Math.cos(t)*40,y:s.y+Math.sin(t)*40,alpha:0,scale:0,duration:500,ease:"Sine.easeOut",onComplete:()=>s.destroy()})}}toggleMarshmallow(){this.currentForm==="marshmallow"?this.transformTo("candy"):this.transformTo("marshmallow")}toggleJelly(){this.currentForm==="jelly"?this.transformTo("candy"):this.transformTo("jelly")}applyBuoyancy(){this.body.velocity.y>0?this.body.setAccelerationY(-400):this.body.setAccelerationY(0)}applyJellyFloat(){this.body.velocity.y>0?this.body.setAccelerationY(-400):this.body.setAccelerationY(0)}applyJellyFastFall(){this.body.setAccelerationY(1200),this.body.velocity.y<200&&this.body.setVelocityY(200)}updateJellyIdleHop(){const e=Date.now();e-this.jellyHopTimer>this.jellyHopInterval&&(this.body.setVelocityY(this.jellyIdleHopVelocity),this.jellyHopTimer=e)}updateRoll(){const e=this.body.velocity.x;let a=1;if(this.currentForm==="marshmallow"&&(a=.5),this.currentForm==="jelly"&&(a=.7),Math.abs(e)>10){const i=e/(this.radius*2)*a;this.rotation+=i*.016}this.updateShinePosition()}updateShinePosition(){if(!this.shine)return;if(this.currentForm==="marshmallow"){this.shine.setAlpha(0);return}else this.shine.setAlpha(1);const e=this.moonX-this.x,a=this.moonY-this.y,i=Math.sqrt(e*e+a*a),t=e/i,s=a/i,n=this.radius*.4;this.shine.x=this.x+t*n,this.shine.y=this.y+s*n}}class he extends l.Physics.Arcade.Sprite{constructor(e,a,i){super(e,a,i,null),this.createPortalVisuals(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(120,180),this.body.setAllowGravity(!1),this.body.setImmovable(!0),this.createAnimations(e)}createPortalVisuals(){if(!this.scene.textures.exists("portal")){const i=this.scene.make.graphics({x:0,y:0});i.fillStyle(16737792,1),i.beginPath(),i.moveTo(180/2-60,40),i.lineTo(180/2-70,180),i.lineTo(180/2+70,180),i.lineTo(180/2+60,40),i.closePath(),i.fillPath(),i.fillStyle(1710618,1),i.fillEllipse(180/2,40,60,20),i.fillStyle(13391104,1),i.fillEllipse(180/2,35,65,15),i.fillStyle(0,1),i.fillTriangle(180/2-30,80,180/2-20,60,180/2-10,80),i.fillTriangle(180/2+10,80,180/2+20,60,180/2+30,80),i.fillTriangle(180/2-8,100,180/2+8,100,180/2,115),i.beginPath(),i.moveTo(180/2-40,130);for(let t=0;t<=8;t++){const s=50+t*10,n=130+(t%2===0?0:12);i.lineTo(s,n)}i.lineTo(180/2-40,142),i.closePath(),i.fillPath(),i.lineStyle(8,13391104,1),i.beginPath(),i.arc(180/2-40,25,20,Math.PI,0,!1),i.strokePath(),i.beginPath(),i.arc(180/2+40,25,20,Math.PI,0,!1),i.strokePath(),i.fillStyle(16755200,.3),i.fillEllipse(180/2,40,70,25),i.generateTexture("portal",180,200),i.destroy()}this.setTexture("portal")}createAnimations(e){const a=e.add.circle(this.x,this.y,80,10040319,.2),i=e.add.circle(this.x,this.y,60,65416,.3);a.setDepth(this.depth-1),i.setDepth(this.depth-1),e.tweens.add({targets:a,scale:1.3,alpha:.1,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.tweens.add({targets:i,scale:1.2,alpha:.15,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.time.addEvent({delay:200,callback:()=>{const t=e.add.circle(this.x+l.Math.Between(-40,40),this.y+l.Math.Between(-70,70),l.Math.Between(2,5),l.Math.Between(0,1)>.5?10040319:65416,.8);e.tweens.add({targets:t,x:this.x,y:this.y,alpha:0,duration:1e3,ease:"Sine.easeIn",onComplete:()=>t.destroy()})},loop:!0}),e.tweens.add({targets:this,scaleX:1.05,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}class X extends l.Physics.Arcade.Sprite{constructor(e,a,i,t,s){e.textures.exists("enemy-bat-1")||X.createBatTextures(e),super(e,a,i,"enemy-bat-1"),this.patrolStart=t,this.patrolEnd=s,this.speed=150,this.direction=1,this.baseY=i,this.bobPhase=Math.random()*Math.PI*2,this.wingFrame=0,this.wingAnimTime=0,e.add.existing(this),e.physics.add.existing(this),this.body.setSize(50,35),this.body.setOffset(5,12),this.body.setAllowGravity(!1),this.body.setImmovable(!0)}static createBatTextures(e){X.createBatFrame(e,"enemy-bat-1",0),X.createBatFrame(e,"enemy-bat-2",.5),X.createBatFrame(e,"enemy-bat-3",1)}static createBatFrame(e,a,i){const r=e.make.graphics({x:0,y:0}),o=i*15;r.fillStyle(4004429,1),r.beginPath(),r.moveTo(38,50),r.lineTo(5,35+o),r.lineTo(10,60+o),r.lineTo(38,55),r.closePath(),r.fillPath(),r.fillTriangle(38,50,20,42+o*.6,25,55+o*.6),r.beginPath(),r.moveTo(62,50),r.lineTo(95,35+o),r.lineTo(90,60+o),r.lineTo(62,55),r.closePath(),r.fillPath(),r.fillTriangle(62,50,80,42+o*.6,75,55+o*.6),r.fillStyle(1706536,1),r.fillEllipse(50,52,24,28),r.fillCircle(50,40,16),r.fillTriangle(38,32,34,20,42,30),r.fillTriangle(62,32,66,20,58,30),r.fillStyle(16711680,1),r.fillCircle(44,40,4),r.fillCircle(56,40,4),r.fillStyle(16729156,.5),r.fillCircle(44,40,8),r.fillCircle(56,40,8),r.fillStyle(16777215,1),r.fillTriangle(46,48,48,54,49,48),r.fillTriangle(54,48,52,54,51,48),r.generateTexture(a,100,100),r.destroy()}update(e,a){this.body.setVelocityX(this.speed*this.direction),this.direction===1&&this.x>=this.patrolEnd?(this.direction=-1,this.setFlipX(!0)):this.direction===-1&&this.x<=this.patrolStart&&(this.direction=1,this.setFlipX(!1));const i=.003;this.bobPhase+=i*(a||16);const s=(this.baseY+Math.sin(this.bobPhase)*15-this.y)*3;this.body.setVelocityY(s),this.wingAnimTime+=a||16,this.wingAnimTime>=150&&(this.wingAnimTime=0,this.wingFrame=(this.wingFrame+1)%3,this.setTexture(`enemy-bat-${this.wingFrame+1}`))}}class ce extends l.Physics.Arcade.Sprite{constructor(e,a,i){super(e,a,i,null),this.createVisuals(),e.add.existing(this),e.physics.add.existing(this),this.body.setSize(60,80),this.body.setAllowGravity(!1),this.body.setImmovable(!0),this.activated=!1}createVisuals(){if(!this.scene.textures.exists("checkpoint")){const i=this.scene.make.graphics({x:0,y:0});i.fillStyle(4868682,1),i.fillRect(80/2-5,60,10,40),i.fillStyle(6710886,1),i.fillRect(80/2-15,20,30,40),i.fillStyle(8947848,.5),i.fillCircle(80/2,40,12),i.generateTexture("checkpoint",80,100),i.destroy()}if(!this.scene.textures.exists("checkpoint-active")){const i=this.scene.make.graphics({x:0,y:0});i.fillStyle(4868682,1),i.fillRect(80/2-5,60,10,40),i.fillStyle(6710886,1),i.fillRect(80/2-15,20,30,40),i.fillStyle(16737792,1),i.fillCircle(80/2,40,12),i.fillStyle(16746496,.4),i.fillCircle(80/2,40,20),i.generateTexture("checkpoint-active",80,100),i.destroy()}this.setTexture("checkpoint")}activate(){if(this.activated)return;this.activated=!0,this.setTexture("checkpoint-active");const e=this.scene.add.circle(this.x,this.y-30,40,16737792,.6);this.scene.tweens.add({targets:e,scale:2,alpha:0,duration:500,onComplete:()=>e.destroy()});for(let a=0;a<10;a++){const i=this.scene.add.circle(this.x+l.Math.Between(-20,20),this.y-30,l.Math.Between(3,6),16746496,.8);this.scene.tweens.add({targets:i,y:i.y-l.Math.Between(50,100),alpha:0,duration:1e3,ease:"Sine.easeOut",onComplete:()=>i.destroy()})}}}class P extends l.GameObjects.Sprite{constructor(e,a,i,t){e.textures.exists("crow-1")||P.createCrowTextures(e),super(e,a,i,"crow-1"),this.direction=t,this.speed=l.Math.Between(100,200),this.wingFrame=0,this.wingAnimTime=0,e.add.existing(this),this.setDepth(-50),this.direction===-1&&this.setFlipX(!0)}static createCrowTextures(e){P.createCrowFrame(e,"crow-1",0),P.createCrowFrame(e,"crow-2",1)}static createCrowFrame(e,a,i){const r=e.make.graphics({x:0,y:0});r.fillStyle(0,.8),r.fillEllipse(30,30,16,20),r.fillCircle(30,22,8),r.fillTriangle(36,22,42,21,36,24),i===0?(r.beginPath(),r.moveTo(22,30),r.lineTo(5,15),r.lineTo(10,25),r.closePath(),r.fillPath(),r.beginPath(),r.moveTo(38,30),r.lineTo(55,15),r.lineTo(50,25),r.closePath(),r.fillPath()):(r.beginPath(),r.moveTo(22,30),r.lineTo(5,40),r.lineTo(10,35),r.closePath(),r.fillPath(),r.beginPath(),r.moveTo(38,30),r.lineTo(55,40),r.lineTo(50,35),r.closePath(),r.fillPath()),r.fillTriangle(24,38,20,45,36,38),r.generateTexture(a,60,60),r.destroy()}update(e){this.x+=this.speed*this.direction*(e/1e3),this.wingAnimTime+=e||16,this.wingAnimTime>=200&&(this.wingAnimTime=0,this.wingFrame=(this.wingFrame+1)%2,this.setTexture(`crow-${this.wingFrame+1}`)),this.direction===1&&this.x>9e3?this.destroy():this.direction===-1&&this.x<-500&&this.destroy()}}class de extends l.Scene{constructor(){super({key:"GameScene"})}create(e){console.log("GameScene create started"),this.currentLevel=e.level||1;const a={1:F,2:ae,3:re,4:ne},i=(this.currentLevel-1)%4+1;this.levelData=a[i],this.physics.world.setBounds(0,0,this.levelData.worldBounds.width,this.levelData.worldBounds.height),this.createParallaxBackground(),this.lives=e.lives!==void 0?e.lives:4,this.isRespawning=!1,this.isFalling=!1,this.currentCheckpoint=this.levelData.playerStart,this.goalReached=!1,this.startTime=this.time.now,this.platformManager=new le(this,this.levelData),this.player=new oe(this,this.levelData.playerStart.x,this.levelData.playerStart.y,this.levelData.worldBounds.width*.75,this.levelData.worldBounds.height*.2),this.enemies=this.physics.add.group(),console.log("Enemy data:",this.levelData.enemies),this.levelData.enemies&&this.levelData.enemies.length>0&&(this.levelData.enemies.forEach((t,s)=>{try{console.log(`Creating enemy ${s} at`,t);const n=new X(this,t.x,t.y,t.patrolStart,t.patrolEnd);this.enemies.add(n),console.log(`Enemy ${s} created:`,n.x,n.y,n.visible)}catch(n){console.error("Error creating enemy:",n)}}),console.log("Total enemies created:",this.enemies.getLength())),this.checkpoints=this.physics.add.group(),this.levelData.checkpoints.forEach(t=>{const s=new ce(this,t.x,t.y);this.checkpoints.add(s)}),this.goal=new he(this,this.levelData.goal.x,this.levelData.goal.y),this.crows=[],this.createCrows(),this.createWaterAreas(),this.platformManager.setupCollisions(this.player),this.physics.add.overlap(this.player,this.checkpoints,this.reachCheckpoint,null,this),this.physics.add.overlap(this.player,this.enemies,this.hitEnemy,null,this),this.physics.add.overlap(this.player,this.goal,this.reachGoal,null,this),this.cursors=this.input.keyboard.createCursorKeys(),this.keys={W:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.W),A:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.A),S:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.S),D:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.D),E:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.E),Q:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.Q),ESC:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.ESC)},this.keys.ESC.on("down",()=>{this.scene.isPaused("GameScene")||(this.scene.pause("GameScene"),this.scene.launch("PauseScene",{level:this.currentLevel,lives:this.lives}))}),this.cameras.main.setBounds(0,0,this.levelData.worldBounds.width,this.levelData.worldBounds.height),this.cameras.main.setZoom(1),this.cameras.main.startFollow(this.player,!0,.1,.1);try{this.createLivesUI(),console.log("Lives UI created")}catch(t){console.error("Error creating lives UI:",t)}console.log("GameScene create completed")}update(){this.player.y>1080&&!this.isRespawning&&!this.isFalling&&(this.isFalling=!0,this.handleDeath(),this.isFalling=!1),this.isRespawning||this.player.update(this.cursors,this.keys),this.waterBodies&&this.checkWaterPhysics(),this.enemies&&this.enemies.children&&this.enemies.children.entries.forEach(e=>{e&&e.update&&e.update()}),this.crows&&this.crows.forEach((e,a)=>{e&&e.active?e.update(this.game.loop.delta):e&&!e.active&&this.crows.splice(a,1)}),this.lastCrowSpawn||(this.lastCrowSpawn=0),this.time.now-this.lastCrowSpawn>8e3&&(this.spawnCrow(),this.lastCrowSpawn=this.time.now)}hitEnemy(e,a){this.isRespawning||this.handleDeath()}handleDeath(){if(!this.isRespawning){if(this.isRespawning=!0,this.lives--,this.updateLivesUI(),this.sound.play("death-sound",{volume:b.getSFXVolume()}),this.player.isDead=!0,this.player.body.setVelocity(0,0),this.player.body.setAcceleration(0,0),this.cameras.main.flash(300,255,0,0),this.player.currentForm==="marshmallow"?this.marshmallowExpire():this.player.currentForm==="jelly"?this.jellyDeath():this.candyBreak(),this.lives<=0){this.time.delayedCall(1e3,()=>{this.scene.start("GameOverScene")});return}this.time.delayedCall(1e3,()=>{const e=4-this.lives;this.scene.pause("GameScene"),this.scene.launch("RespawnScene",{livesLost:e,livesRemaining:this.lives})})}}candyBreak(){this.player.setVisible(!1),this.player.shine.setVisible(!1),this.createDeathMarker(this.player.x,this.player.y);for(let e=0;e<12;e++){const a=e*Math.PI*2/12,i=this.add.circle(this.player.x,this.player.y,l.Math.Between(4,8),e%2===0?16742144:16755200,1);i.setDepth(10);const t=l.Math.Between(100,200);this.tweens.add({targets:i,x:i.x+Math.cos(a)*t,y:i.y+Math.sin(a)*t,alpha:0,scale:0,duration:600,ease:"Cubic.easeOut",onComplete:()=>i.destroy()})}}jellyDeath(){this.player.setVisible(!1),this.player.shine.setVisible(!1),this.createDeathMarker(this.player.x,this.player.y);for(let e=0;e<15;e++){const a=this.add.circle(this.player.x+l.Math.Between(-30,30),this.player.y+l.Math.Between(-30,30),l.Math.Between(5,12),4521796,.7);a.setDepth(10),this.tweens.add({targets:a,y:a.y+l.Math.Between(50,100),alpha:0,scale:.3,duration:l.Math.Between(700,1e3),ease:"Cubic.easeOut",onComplete:()=>a.destroy()})}}marshmallowExpire(){this.player.shine.setVisible(!1),this.createDeathMarker(this.player.x,this.player.y),this.tweens.add({targets:this.player,tint:2759183,duration:300,ease:"Sine.easeIn",onComplete:()=>{this.player.setVisible(!1);for(let e=0;e<15;e++){const a=this.add.circle(this.player.x+l.Math.Between(-25,25),this.player.y+l.Math.Between(-25,25),l.Math.Between(3,8),l.Math.Between(0,1)>.5?4007959:1707784,1);a.setDepth(10),this.tweens.add({targets:a,y:a.y+l.Math.Between(80,150),x:a.x+l.Math.Between(-30,30),alpha:0,scale:.3,duration:l.Math.Between(800,1200),ease:"Cubic.easeOut",onComplete:()=>a.destroy()})}for(let e=0;e<8;e++){const a=this.add.circle(this.player.x+l.Math.Between(-20,20),this.player.y,l.Math.Between(8,15),6710886,.4);a.setDepth(11),this.tweens.add({targets:a,y:a.y-l.Math.Between(60,120),x:a.x+l.Math.Between(-40,40),scale:2,alpha:0,duration:1e3,ease:"Sine.easeOut",onComplete:()=>a.destroy()})}}})}createDeathMarker(e,a){const t=this.make.graphics({x:0,y:0});t.fillStyle(16777215,.8),t.beginPath(),t.moveTo(60/2,10),t.lineTo(60/2-20,15),t.lineTo(60/2-25,30),t.lineTo(60/2-20,45),t.lineTo(60/2-15,50),t.lineTo(60/2-10,45),t.lineTo(60/2-5,50),t.lineTo(60/2,45),t.lineTo(60/2+5,50),t.lineTo(60/2+10,45),t.lineTo(60/2+15,50),t.lineTo(60/2+20,45),t.lineTo(60/2+25,30),t.lineTo(60/2+20,15),t.closePath(),t.fillPath(),t.fillStyle(0,1),t.fillCircle(60/2-8,25,4),t.fillCircle(60/2+8,25,4),t.fillCircle(60/2,35,3),t.fillStyle(10053375,.3),t.fillCircle(60/2,30,30),t.generateTexture("death-marker",60,60),t.destroy();const s=this.add.sprite(e,a-40,"death-marker");s.setDepth(1e3),s.setAlpha(0),this.tweens.add({targets:s,alpha:1,y:a-80,duration:400,ease:"Sine.easeOut",onComplete:()=>{this.tweens.add({targets:s,alpha:0,y:a-100,duration:600,delay:200,ease:"Sine.easeIn",onComplete:()=>s.destroy()})}}),this.tweens.add({targets:s,y:s.y-10,duration:800,yoyo:!0,repeat:1,ease:"Sine.easeInOut"})}createLivesUI(){if(this.livesIcons=[],!this.textures.exists("heart")){const e=this.add.graphics();e.fillStyle(16711680,1),e.fillCircle(10,5,8),e.fillCircle(20,5,8),e.fillTriangle(2,8,28,8,15,25),e.generateTexture("heart",30,30),e.destroy()}this.livesContainer=this.add.container(0,0),this.livesContainer.setScrollFactor(0),this.livesContainer.setDepth(1e3);for(let e=0;e<4;e++){const a=this.add.image(70+e*45,50,"heart").setScale(.9);this.livesContainer.add(a),this.livesIcons.push(a)}this.updateLivesUI()}updateLivesUI(){if(this.livesIcons)for(let e=0;e<this.livesIcons.length;e++)this.livesIcons[e].setAlpha(e<this.lives?1:.3)}respawnPlayer(){this.player.setPosition(this.currentCheckpoint.x,this.currentCheckpoint.y),this.player.setVelocity(0,0),this.player.setAcceleration(0,0),this.player.setVisible(!0),this.player.setAlpha(1),this.player.setScale(1,1),this.player.clearTint(),this.player.isDead=!1,this.player.currentForm!=="candy"&&this.player.transformTo("candy"),this.player.shine.setVisible(!0),this.cameras.main.startFollow(this.player,!0,.1,.1),this.isRespawning=!1}loseLife(){this.handleDeath()}showResurrectionScreen(){const e=this.cameras.main.width/2,a=this.cameras.main.height/2,i=this.add.rectangle(e,a,this.cameras.main.width*2,this.cameras.main.height*2,0,.8);i.setScrollFactor(0),i.setDepth(2e3);const t=this.add.text(e,a-40,"RESURRECTING...",{fontSize:"64px",fill:"#ff6600",fontStyle:"bold",stroke:"#000000",strokeThickness:6});t.setOrigin(.5),t.setScrollFactor(0),t.setDepth(2001);const s=this.add.text(e,a+60,`⚠️ BEWARE THE CURSED BATS! ⚠️
Their touch is deadly...`,{fontSize:"32px",fill:"#ff3333",fontStyle:"italic",align:"center",stroke:"#000000",strokeThickness:4});s.setOrigin(.5),s.setScrollFactor(0),s.setDepth(2001),this.tweens.add({targets:s,alpha:.5,duration:300,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:t,alpha:.3,scale:1.1,duration:400,yoyo:!0,repeat:2,ease:"Sine.easeInOut"});for(let n=0;n<8;n++){const r=this.add.circle(e+l.Math.Between(-100,100),a+l.Math.Between(-50,50),l.Math.Between(10,20),10053375,.6);r.setScrollFactor(0),r.setDepth(2001),this.tweens.add({targets:r,y:r.y-100,alpha:0,duration:1500,ease:"Sine.easeOut",onComplete:()=>r.destroy()})}this.time.delayedCall(1800,()=>{i.destroy(),t.destroy(),s.destroy(),this.player.setPosition(this.currentCheckpoint.x,this.currentCheckpoint.y),this.player.setVelocity(0,0),this.isRespawning=!1})}reachCheckpoint(e,a){if(!a.activated){a.activate(),this.currentCheckpoint={x:a.x,y:a.y-50};const t=F.checkpoints.findIndex(r=>Math.abs(r.x-a.x)<10)+2,s=this.add.text(this.cameras.main.width/2,100,"CHECKPOINT SAVED!",{fontSize:"48px",fill:"#00ff00",fontStyle:"bold",stroke:"#000000",strokeThickness:4});s.setOrigin(.5),s.setScrollFactor(0),s.setDepth(1500);const n=this.add.text(this.cameras.main.width/2,160,`Section ${t} of 3`,{fontSize:"32px",fill:"#ffaa00",fontStyle:"bold",stroke:"#000000",strokeThickness:3});n.setOrigin(.5),n.setScrollFactor(0),n.setDepth(1500),this.tweens.add({targets:[s,n],y:"-=20",alpha:0,duration:2e3,ease:"Sine.easeOut",onComplete:()=>{s.destroy(),n.destroy()}})}}reachGoal(){if(this.goalReached)return;this.goalReached=!0;const e=Math.floor((this.time.now-this.startTime)/1e3);this.player.isDead=!0,this.player.body.setVelocity(0,0),this.player.body.setAcceleration(0,0),this.player.body.setAllowGravity(!1),this.player.body.setBounce(0),this.player.body.enable=!1,this.tweens.add({targets:[this.player,this.player.shine],x:this.goal.x,y:this.goal.y-80,scale:.3,duration:800,ease:"Sine.easeIn",onComplete:()=>{this.tweens.add({targets:[this.player,this.player.shine],y:this.goal.y-60,scale:0,alpha:0,duration:400,ease:"Power2.easeIn",onComplete:()=>{for(let a=0;a<20;a++){const i=this.add.circle(this.goal.x+l.Math.Between(-30,30),this.goal.y-60,l.Math.Between(3,8),16755200,1);this.tweens.add({targets:i,y:i.y-l.Math.Between(50,100),x:i.x+l.Math.Between(-40,40),alpha:0,scale:0,duration:1e3,ease:"Sine.easeOut",onComplete:()=>i.destroy()})}this.time.delayedCall(800,()=>{this.scene.start("VictoryScene",{time:e,level:this.currentLevel,lives:this.lives})})}})}})}gameOver(){this.scene.start("GameOverScene")}createHalloweenBackground(){const e=F.worldBounds.width,a=Math.max(F.worldBounds.height,this.scale.height),i=this.add.graphics();for(let c=0;c<a;c++){const d=l.Display.Color.Interpolate.ColorWithColor({r:40,g:20,b:50},{r:80,g:50,b:90},a,c);i.fillStyle(l.Display.Color.GetColor(d.r,d.g,d.b),1),i.fillRect(0,c,e,1)}i.fillStyle(657930,1),i.fillRect(0,a,e,500);const t=e*.6,s=a*.25,n=200,r=this.add.circle(t,s,n+100,16764006,.12);r.setDepth(1),r.setScrollFactor(0);const o=this.add.circle(t,s,n+50,16768375,.2);o.setDepth(2),o.setScrollFactor(0);const y=this.add.circle(t,s,n,16772744);y.setDepth(3),y.setScrollFactor(0);const h=this.add.graphics();h.fillStyle(16764006,.3),h.fillCircle(t-60,s-40,50),h.fillCircle(t+50,s+30,40),h.fillCircle(t-20,s+60,35),h.fillCircle(t+70,s-50,30),h.fillCircle(t-80,s+25,25),h.fillStyle(16755268,.2),h.fillCircle(t+20,s-70,45),h.fillCircle(t-40,s+10,38),h.setDepth(4),h.setScrollFactor(0),this.createHalloweenCastle(e,a),this.createDistantHills(e,a);for(let c=0;c<3;c++){const d=this.add.graphics(),f=.04+c*.02;d.fillStyle(11184844,f);for(let g=0;g<4;g++){const m=e/4*g+l.Math.Between(-100,100),u=a-80+c*30,p=e*.4,w=120-c*20;d.fillEllipse(m,u,p,w)}this.tweens.add({targets:d,alpha:f*.5,duration:5e3+c*1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createCastleSilhouette(e,a){const i=this.add.graphics();i.fillStyle(657941,.9);const t=a-150,s=500,n=450;i.fillRect(e,t-n,s,n);const r=90,o=600;i.fillRect(e-30,t-o,r,o),i.fillTriangle(e-30,t-o,e+r/2-30,t-o-100,e+r-30,t-o);const y=90,h=580;i.fillRect(e+s-60,t-h,y,h),i.fillTriangle(e+s-60,t-h,e+s-60+y/2,t-h-95,e+s-60+y,t-h);const c=650,d=110;i.fillRect(e+s/2-d/2,t-c,d,c),i.fillTriangle(e+s/2-d/2,t-c,e+s/2,t-c-120,e+s/2+d/2,t-c);const f=60,g=480;i.fillRect(e+120,t-g,f,g),i.fillTriangle(e+120,t-g,e+120+f/2,t-g-70,e+120+f,t-g),i.fillRect(e+s-180,t-g,f,g),i.fillTriangle(e+s-180,t-g,e+s-180+f/2,t-g-70,e+s-180+f,t-g);for(let p=0;p<10;p++){const w=e+p*50;p%2===0&&i.fillRect(w,t-n,30,-25)}i.setDepth(-5);const m=this.add.graphics();[{x:e+15,y:t-500,w:20,h:35},{x:e+15,y:t-400,w:20,h:35},{x:e+15,y:t-300,w:20,h:35},{x:e+s-30,y:t-480,w:20,h:35},{x:e+s-30,y:t-380,w:20,h:35},{x:e+s-30,y:t-280,w:20,h:35},{x:e+s/2-10,y:t-550,w:20,h:35},{x:e+s/2-10,y:t-450,w:20,h:35},{x:e+s/2-10,y:t-350,w:20,h:35}].forEach(p=>{m.fillStyle(16746496,.8),m.fillRect(p.x,p.y,p.w,p.h);const w=this.add.rectangle(p.x+p.w/2,p.y+p.h/2,p.w,p.h,16746496,.8);w.setDepth(-4),this.tweens.add({targets:w,alpha:.5,duration:l.Math.Between(1e3,2500),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})});for(let p=0;p<4;p++)for(let w=0;w<4;w++){const k=e+130+w*60,v=t-380+p*70;if(m.fillStyle(16746496,.7),m.fillRect(k,v,22,38),Math.random()>.4){const S=this.add.rectangle(k+11,v+19,22,38,16746496,.7);S.setDepth(-4),this.tweens.add({targets:S,alpha:.4,duration:l.Math.Between(800,2e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}m.setDepth(-4)}createFlyingWitch(e,a){const t=a*.25,s=this.add.graphics();s.fillStyle(0,.9),s.fillCircle(0,0,15),s.fillTriangle(-8,-15,0,-30,8,-15),s.fillEllipse(0,20,18,30),s.fillRect(-40,25,80,4),s.fillTriangle(-60,23,-40,27,-40,23),s.x=-100,s.y=t,s.setDepth(5),this.tweens.add({targets:s,x:e+100,y:t+Math.sin(-100/200)*50,duration:45e3,repeat:-1,ease:"Linear",onUpdate:()=>{s.y=t+Math.sin(s.x/200)*30}})}createGlowingJackOLanterns(e,a){[{x:1200,y:a-135},{x:3600,y:a-138},{x:6e3,y:a-140}].forEach(t=>{const s=l.Math.Between(45,65);this.add.circle(t.x,t.y,s,16746496).setDepth(2);const r=this.add.circle(t.x,t.y,s+15,16737792,.3);r.setDepth(1),this.tweens.add({targets:r,scale:1.2,alpha:.1,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const o=this.add.graphics();o.fillStyle(16776960,1),o.fillTriangle(t.x-s*.3,t.y-s*.2,t.x-s*.15,t.y-s*.4,t.x-s*0,t.y-s*.2),o.fillTriangle(t.x+s*0,t.y-s*.2,t.x+s*.15,t.y-s*.4,t.x+s*.3,t.y-s*.2);for(let y=0;y<5;y++){const h=t.x-s*.3+y*s*.15;o.fillTriangle(h,t.y+s*.1,h+s*.07,t.y+s*.3,h+s*.15,t.y+s*.1)}o.setDepth(-1),o.setDepth(3),this.tweens.add({targets:o,alpha:.7,duration:l.Math.Between(300,800),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})})}createColorfulGhosts(e,a){const i=[65535,16711935,65416];for(let t=0;t<5;t++){const s=e/5*t+l.Math.Between(-100,100),n=l.Math.Between(400,650),r=l.Utils.Array.GetRandom(i),o=this.add.ellipse(s,n,50,60,r,.6);o.setDepth(2);const y=this.add.ellipse(s,n,70,80,r,.2);y.setDepth(1);const h=this.add.graphics();h.fillStyle(r,.6),h.beginPath(),h.moveTo(s-25,n+30);for(let f=0;f<5;f++)h.lineTo(s-25+f*12.5,n+30+(f%2===0?10:0));h.lineTo(s+25,n+20),h.lineTo(s-25,n+20),h.closePath(),h.fillPath(),h.setDepth(2);const c=this.add.circle(s-12,n-5,6,16777215),d=this.add.circle(s+12,n-5,6,16777215);c.setDepth(3),d.setDepth(3),this.tweens.add({targets:[o,y,h,c,d],y:n-30,duration:l.Math.Between(3e3,5e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:y,scale:1.3,alpha:.05,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createMagicCauldrons(e,a){[{x:2e3,y:a-105},{x:5e3,y:a-100}].forEach(t=>{this.add.ellipse(t.x,t.y,60,50,2236962).setDepth(2);const n=this.add.ellipse(t.x,t.y-15,50,20,65280,.8);n.setDepth(3);const r=this.add.ellipse(t.x,t.y-15,70,40,65280,.3);r.setDepth(1),this.time.addEvent({delay:800,callback:()=>{const o=this.add.circle(t.x+l.Math.Between(-20,20),t.y-10,l.Math.Between(3,8),8978312,.8);o.setDepth(3),this.tweens.add({targets:o,y:t.y-80,alpha:0,duration:2e3,ease:"Sine.easeOut",onComplete:()=>o.destroy()})},loop:!0}),this.tweens.add({targets:[n,r],alpha:n.alpha*.5,duration:1500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})})}createHangingLanterns(e,a){const i=[16724838,16755200,16711935];for(let t=0;t<6;t++){const s=e/6*t+l.Math.Between(-50,50),n=l.Math.Between(250,450),r=l.Utils.Array.GetRandom(i),o=this.add.line(0,0,s,n-80,s,n-30,6710886,.5);o.setOrigin(0,0),o.setDepth(2);const y=this.add.rectangle(s,n,30,40,r,.9);y.setDepth(3);const h=this.add.rectangle(s,n,50,60,r,.3);h.setDepth(1),this.tweens.add({targets:[o,y,h],x:s+l.Math.Between(-15,15),duration:l.Math.Between(2e3,4e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:h,scale:1.4,alpha:.1,duration:1800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createSpookyEyes(e,a){const i=[16711680,16776960];for(let t=0;t<8;t++){const s=e/8*t+l.Math.Between(-100,100),n=l.Math.Between(550,750),r=l.Utils.Array.GetRandom(i),o=l.Math.Between(8,12),y=this.add.circle(s-15,n,o,r,.9);y.setDepth(3);const h=this.add.circle(s+15,n,o,r,.9);h.setDepth(3);const c=this.add.circle(s-15,n,o+5,r,.3),d=this.add.circle(s+15,n,o+5,r,.3);c.setDepth(1),d.setDepth(1),this.time.addEvent({delay:l.Math.Between(3e3,8e3),callback:()=>{this.tweens.add({targets:[y,h],scaleY:.1,duration:100,yoyo:!0,ease:"Linear"})},loop:!0}),this.tweens.add({targets:[c,d],scale:1.5,alpha:.1,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createBackgroundPumpkins(e,a){const i=this.add.graphics();[{x:e*.2,y:a-120,size:55},{x:e*.5,y:a-110,size:50},{x:e*.8,y:a-115,size:52}].forEach(s=>{i.fillStyle(13386752,.25),i.fillEllipse(s.x,s.y,s.size,s.size*.9),i.lineStyle(2,10040064,.2);for(let o=-1;o<=1;o++)i.beginPath(),i.moveTo(s.x+o*s.size/4,s.y-s.size/2),i.lineTo(s.x+o*s.size/4,s.y+s.size/2),i.strokePath();const n=this.add.graphics();n.fillStyle(16746496,.4),n.fillTriangle(s.x-s.size/4,s.y-s.size/6,s.x-s.size/6,s.y-s.size/4,s.x-s.size/8,s.y-s.size/6),n.fillTriangle(s.x+s.size/8,s.y-s.size/6,s.x+s.size/6,s.y-s.size/4,s.x+s.size/4,s.y-s.size/6),n.fillTriangle(s.x-5,s.y,s.x,s.y-10,s.x+5,s.y),n.lineStyle(2,16746496,.4),n.beginPath(),n.moveTo(s.x-s.size/3,s.y+s.size/6);for(let o=0;o<6;o++){const y=s.x-s.size/3+o*s.size/9,h=s.y+s.size/6+(o%2===0?8:0);n.lineTo(y,h)}n.strokePath(),n.setDepth(-1);const r=this.add.circle(s.x,s.y,s.size*.6,16737792,.08);r.setDepth(-1),this.tweens.add({targets:r,alpha:.03,duration:l.Math.Between(1500,2500),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),i.fillStyle(1707784,.3),i.fillRect(s.x-8,s.y-s.size/2-15,16,20)}),i.setDepth(-1)}createSpookyTrees(e,a){[{x:e*.15,scale:1.1,depth:.85},{x:e*.5,scale:.95,depth:.75},{x:e*.85,scale:1.05,depth:.8}].forEach(t=>{this.createSingleSpookyTree(t.x,a,t.scale,t.depth)})}createSingleSpookyTree(e,a,i=1,t=.85){const s=this.add.graphics();s.fillStyle(2763306,1);const n=80*i,r=400*i,o=a-50,y=[e-n/2,o,e-n/3,o-r,e+n/3,o-r,e+n/2,o];s.fillPoints(y,!0),[{startY:.3,angle:-45,length:150,curve:20},{startY:.5,angle:-60,length:120,curve:-15},{startY:.7,angle:-30,length:100,curve:25},{startY:.35,angle:45,length:140,curve:-20},{startY:.55,angle:50,length:110,curve:15},{startY:.75,angle:35,length:90,curve:-25},{startY:.15,angle:-70,length:80,curve:10},{startY:.2,angle:70,length:85,curve:-10}].forEach(S=>{const D=o-r*S.startY,I=e;l.Math.DegToRad(S.angle);const K=S.length*i,E=5;let C=I,B=D,z=S.angle;for(let O=0;O<E;O++){const L=K/E,_=(15-O*2)*i;z+=S.curve/E;const A=l.Math.DegToRad(z),G=C+Math.cos(A)*L,R=B+Math.sin(A)*L,T=A+Math.PI/2,M=_/2;if(s.fillPoints([C+Math.cos(T)*M,B+Math.sin(T)*M,C-Math.cos(T)*M,B-Math.sin(T)*M,G-Math.cos(T)*(M*.7),R-Math.sin(T)*(M*.7),G+Math.cos(T)*(M*.7),R+Math.sin(T)*(M*.7)],!0),C=G,B=R,O===E-1)for(let j=0;j<3;j++){const J=z+l.Math.Between(-40,40),W=l.Math.DegToRad(J),H=l.Math.Between(15,30)*i,N=C+Math.cos(W)*H,U=B+Math.sin(W)*H;s.lineStyle(3*i,2763306,1),s.beginPath(),s.moveTo(C,B),s.lineTo(N,U),s.strokePath()}}});const c=o-r*.5,d=this.add.graphics(),f=16750848,g=.5;d.fillStyle(f,g);const m=e-25*i;d.fillTriangle(m-15*i,c-5*i,m,c-25*i,m+15*i,c-5*i);const u=e+25*i;d.fillTriangle(u-15*i,c-5*i,u,c-25*i,u+15*i,c-5*i),d.lineStyle(4*i,f,g),d.beginPath(),d.moveTo(e-35*i,c+30*i);const p=8;for(let S=0;S<=p;S++){const D=e-35*i+S*70*i/p,I=c+30*i+(S%2===0?0:12*i);d.lineTo(D,I)}d.strokePath();const w=this.add.circle(m,c-10*i,20*i,f,.12),k=this.add.circle(u,c-10*i,20*i,f,.12),v=this.add.ellipse(e,c+35*i,80*i,30*i,f,.08);this.tweens.add({targets:[w,k,v],alpha:.03,duration:l.Math.Between(2e3,3500),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.time.addEvent({delay:l.Math.Between(5e3,1e4),callback:()=>{this.tweens.add({targets:d,alpha:0,duration:100,yoyo:!0,repeat:1})},loop:!0})}createGraveyard(e,a){[{x:e*.15,tombstones:3},{x:e*.45,tombstones:2},{x:e*.75,tombstones:3}].forEach(t=>{for(let s=0;s<t.tombstones;s++){const n=t.x+l.Math.Between(-150,150),r=a-l.Math.Between(80,120);this.createTombstone(n,r)}})}createTombstone(e,a){const i=this.add.graphics();i.fillStyle(1710638,.4);const t=l.Math.Between(30,50),s=l.Math.Between(60,90);i.fillRect(e-t/2,a-s,t,s),i.fillCircle(e,a-s,t/2),i.fillStyle(657941,.5),Math.random()>.5?(i.fillRect(e-3,a-s+15,6,25),i.fillRect(e-10,a-s+22,20,6)):(i.fillRect(e-12,a-s+20,8,15),i.fillRect(e-2,a-s+20,4,15),i.fillRect(e+6,a-s+20,8,15)),i.rotation=l.Math.FloatBetween(-.1,.1),i.setDepth(-2)}createHauntedFence(e,a){const i=a-60;for(let t=0;t<e;t+=200)Math.random()>.3&&this.createFenceSection(t,i)}createFenceSection(e,a){const i=this.add.graphics();i.fillStyle(1707784,.35);for(let t=0;t<4;t++){const s=e+t*50,n=l.Math.Between(40,50);i.fillRect(s,a-n,8,n),i.fillTriangle(s,a-n-10,s+4,a-n,s+8,a-n-10),t<3&&i.fillRect(s+8,a-n+15,42,6)}i.setDepth(-2)}createBackgroundBats(e,a){for(let i=0;i<4;i++){const t=l.Math.Between(0,e),s=l.Math.Between(100,a*.5);this.createFlyingBat(t,s)}}createFlyingBat(e,a){const i=this.add.graphics();i.fillStyle(657941,.3),i.fillTriangle(-8,0,-15,-5,-10,5),i.fillTriangle(8,0,15,-5,10,5),i.fillCircle(0,0,4),i.x=e,i.y=a,i.setDepth(-5);const s=(Math.random()>.5?1:-1)>0?e+2e3:e-2e3;this.tweens.add({targets:i,x:s,duration:l.Math.Between(15e3,25e3),repeat:-1,yoyo:!0,ease:"Sine.easeInOut"}),this.tweens.add({targets:i,y:a+30,duration:l.Math.Between(2e3,3e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:i,scaleX:1.2,duration:300,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createFloatingGhosts(e,a){for(let i=0;i<3;i++){const t=l.Math.Between(0,e),s=l.Math.Between(200,a*.6);this.createGhost(t,s)}}createGhost(e,a){const i=this.add.graphics();i.fillStyle(13421823,.08),i.fillCircle(0,-15,20),i.fillRect(-20,-15,40,30),i.beginPath(),i.moveTo(-20,15);for(let t=0;t<=4;t++){const s=-20+t*10,n=15+(t%2===0?5:0);i.lineTo(s,n)}i.lineTo(-20,15),i.closePath(),i.fillPath(),i.fillStyle(0,.15),i.fillCircle(-8,-15,3),i.fillCircle(8,-15,3),i.x=e,i.y=a,i.setDepth(-3),this.tweens.add({targets:i,y:a-50,duration:l.Math.Between(4e3,6e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:i,x:e+l.Math.Between(-100,100),duration:l.Math.Between(8e3,12e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.tweens.add({targets:i,alpha:.05,duration:l.Math.Between(3e3,5e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}createHalloweenCastle(e,a){const s=this.add.graphics();s.fillStyle(657941,.9);const n=500,r=400,o=350;s.fillRect(200,n-o,r,o);const y=80,h=450;s.fillRect(180,n-h,y,h),s.fillTriangle(180,n-h,200+y/2-20,n-h-80,200+y-20,n-h);const c=80,d=430;s.fillRect(200+r-60,n-d,c,d),s.fillTriangle(200+r-60,n-d,200+r-60+c/2,n-d-75,200+r-60+c,n-d);const f=500,g=100;s.fillRect(200+r/2-g/2,n-f,g,f),s.fillTriangle(200+r/2-g/2,n-f,200+r/2,n-f-100,200+r/2+g/2,n-f);for(let u=0;u<8;u++){const p=200+u*50;u%2===0&&s.fillRect(p,n-o,30,-20)}s.setDepth(1),s.setScrollFactor(.2),[{x:220,y:n-380,w:18,h:30},{x:220,y:n-300,w:18,h:30},{x:220,y:n-220,w:18,h:30},{x:200+r-30,y:n-360,w:18,h:30},{x:200+r-30,y:n-280,w:18,h:30},{x:200+r-30,y:n-200,w:18,h:30},{x:200+r/2-9,y:n-420,w:18,h:30},{x:200+r/2-9,y:n-340,w:18,h:30},{x:200+r/2-9,y:n-260,w:18,h:30}].forEach(u=>{const p=this.add.rectangle(u.x,u.y,u.w,u.h,16746496,.8);p.setDepth(2),p.setScrollFactor(.2),this.tweens.add({targets:p,alpha:.5,duration:l.Math.Between(1500,2500),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})});for(let u=0;u<3;u++)for(let p=0;p<3;p++){const w=320+p*60,k=n-280+u*70,v=this.add.rectangle(w,k,20,35,16746496,.7);v.setDepth(2),v.setScrollFactor(.2),Math.random()>.5&&this.tweens.add({targets:v,alpha:.4,duration:l.Math.Between(1200,2200),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createDistantHills(e,a){[{color:4007493,alpha:.6,yOffset:350,count:3},{color:4861778,alpha:.7,yOffset:280,count:4},{color:5913186,alpha:.8,yOffset:220,count:5}].forEach((t,s)=>{for(let n=0;n<t.count;n++){const r=e/t.count*n+e/t.count/2,o=a-t.yOffset+Math.sin(n*Math.PI/2)*40,y=e/t.count*1.8,h=200+Math.random()*80;this.add.ellipse(r,o,y,h,t.color,t.alpha).setDepth(-10+s)}})}createGroundMist(e,a){const i=a-40;for(let t=0;t<e;t+=300){const s=this.add.graphics();s.fillStyle(10066380,.03);const n=l.Math.Between(200,400),r=l.Math.Between(30,60);s.fillEllipse(t+l.Math.Between(-50,50),i,n,r),s.setDepth(-1),this.tweens.add({targets:s,x:s.x+l.Math.Between(20,50),alpha:.01,duration:l.Math.Between(8e3,12e3),yoyo:!0,repeat:-1,ease:"Sine.easeInOut"})}}createParallaxBackground(){const e=this.levelData.worldBounds.width,a=this.levelData.worldBounds.height;[{key:"bg-layer-1",scrollFactor:.1,depth:-100},{key:"bg-layer-2",scrollFactor:.2,depth:-90},{key:"bg-layer-3",scrollFactor:.4,depth:-80},{key:"bg-layer-4",scrollFactor:.6,depth:-70},{key:"bg-layer-5",scrollFactor:.8,depth:-60}].forEach(t=>{if(!this.textures.exists(t.key)){console.warn(`Background layer ${t.key} not found, skipping`);return}const s=this.textures.get(t.key),n=s.source[0].width,r=s.source[0].height,o=e*(1+t.scrollFactor),y=Math.ceil(o/n)+1,h=Math.ceil(a/r)+1;for(let c=0;c<y;c++)for(let d=0;d<h;d++){const f=this.add.image(c*n,d*r,t.key);f.setOrigin(0,0),f.setDepth(t.depth),f.setScrollFactor(t.scrollFactor)}})}createWaterAreas(){this.waterBodies=[],this.levelData.waterAreas.forEach(e=>{const a=this.add.graphics(),i=e.x-e.width/2,t=e.y-e.height/2;a.fillStyle(1723770,.7),a.fillRect(i,t+20,e.width,e.height-20),a.fillStyle(2254506,.6),a.fillRect(i,t+10,e.width,e.height-30),a.fillStyle(3377356,.5),a.fillRect(i,t,e.width,20),a.setDepth(1);const s=this.add.rectangle(e.x,e.y-e.height/2+8,e.width,16,5609949,.4);s.setDepth(2),this.tweens.add({targets:s,alpha:.2,scaleY:1.2,duration:2e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const n=this.add.rectangle(e.x,e.y-e.height/2+3,e.width,6,8965375,.5);n.setDepth(2),this.tweens.add({targets:n,alpha:.3,scaleX:1.03,duration:1800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"});const r=this.add.ellipse(e.x,e.y-e.height/2+10,e.width*.8,12,6724095,.3);r.setDepth(1),this.tweens.add({targets:r,scaleX:1.05,alpha:.15,duration:2200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.waterBodies.push({left:e.x-e.width/2,right:e.x+e.width/2,top:e.y-e.height/2,bottom:e.y+e.height/2,surfaceY:e.y-e.height/2})})}checkWaterPhysics(){if(this.player.currentForm!=="marshmallow"){this.player.inWater=!1,this.player.justEnteredWater=!1;return}let e=!1,a=0,i=!1,t=0,s=0;if(this.waterBodies.forEach(n=>{if(this.player.x>=n.left&&this.player.x<=n.right&&this.player.y>=n.top-50&&this.player.y<=n.bottom){e=!0,a=n.surfaceY,t=n.left,s=n.right;const r=this.player.x-n.left,o=n.right-this.player.x;i=r<120||o<120}}),e&&!this.player.inWater){this.player.justEnteredWater=!0,this.player.waterEntryVelocity=this.player.body.velocity.y;const n=Math.min(Math.abs(this.player.waterEntryVelocity)/500,1);this.createWaterSplash(this.player.x,a,n),this.player.waterDipAmount=Math.min(Math.abs(this.player.waterEntryVelocity)/30,25),this.player.waterDipRecovery=0}if(this.player.inWater=e,e){this.player.waterBobPhase+=this.player.waterBobSpeed;const n=Math.sin(this.player.waterBobPhase)*6;if(this.player.waterDipAmount>0){this.player.waterDipRecovery+=.04;const c=1-Math.pow(1-this.player.waterDipRecovery,3);this.player.waterDipAmount*=1-c*.15,this.player.waterDipRecovery>=1&&(this.player.waterDipAmount=0,this.player.waterDipRecovery=0)}const r=Math.abs(this.player.body.velocity.x);r>50?this.player.waterBobSpeed=.02+r/1e4:this.player.waterBobSpeed=.02;const o=180+r*.5;this.player.body.setDrag(o,0);const y=this.player.body.velocity.x/300*.15;this.player.rotation+=(y-this.player.rotation)*.1;let h=!1;if(i){const c=this.player.body.velocity.x<-20,d=this.player.body.velocity.x>20,f=this.player.x-t<120,g=s-this.player.x<120;if(c&&f||d&&g){h=!0;const u=1-Math.min(f?this.player.x-t:s-this.player.x,120)/120,p=u*-600;this.player.body.setVelocityY(p),this.player.y-=5;const w=u*280;d?this.player.body.setVelocityX(Math.max(this.player.body.velocity.x,w)):c&&this.player.body.setVelocityX(Math.min(this.player.body.velocity.x,-w))}}if(!h){const d=a+15+n+this.player.waterDipAmount-this.player.y,g=6+Math.min(Math.abs(d)/20,1)*4,m=d*g,u=this.player.body.velocity.y*-.6,p=m+u;if(this.player.body.setVelocityY(p),r>50){const w=Math.sin(this.player.waterBobPhase*2)*2;this.player.body.setVelocityY(this.player.body.velocity.y+w)}}this.player.justEnteredWater=!1}else this.player.body.setDrag(50,0),this.player.waterDipAmount=0,this.player.waterDipRecovery=0,this.player.waterBobSpeed=.02}createWaterSplash(e,a,i){const t=Math.floor(8+i*12);for(let n=0;n<t;n++){const r=Math.PI/3+(Math.random()-.5)*(Math.PI/2),o=100+Math.random()*150*i,y=3+Math.random()*4*i,h=this.add.circle(e+(Math.random()-.5)*40,a,y,5609949,.8);h.setDepth(10);const c=Math.cos(r-Math.PI/2)*o*(Math.random()>.5?1:-1),d=Math.sin(r-Math.PI/2)*o*-1;this.tweens.add({targets:h,x:h.x+c*.3,y:h.y+d*.3,alpha:0,scale:.3,duration:400+Math.random()*200,ease:"Cubic.easeOut",onComplete:()=>h.destroy()})}const s=this.add.circle(e,a,10,8965375,.6);s.setDepth(9),this.tweens.add({targets:s,scale:4+i*2,alpha:0,duration:600,ease:"Sine.easeOut",onComplete:()=>s.destroy()})}createCrows(){for(let a=0;a<3;a++){const i=Math.random()>.5?1:-1,t=i===1?-100:F.worldBounds.width+100,s=l.Math.Between(100,300),n=new P(this,t,s,i);this.crows.push(n)}}spawnCrow(){const e=Math.random()>.5?1:-1,a=e===1?-100:F.worldBounds.width+100,i=l.Math.Between(100,300),t=new P(this,a,i,e);this.crows.push(t)}}class ye extends l.Scene{constructor(){super({key:"GameOverScene"})}preload(){this.load.image("chibi-kid-1","/crying-chibi/chibi_one_crying-removebg-preview.png"),this.load.image("chibi-kid-2","/crying-chibi/chibi_two_crying-removebg-preview.png"),this.load.image("chibi-kid-3","/crying-chibi/chibi_three_crying-removebg-preview.png")}create(){const e=this.sound.get("bgm");e&&e.isPlaying&&e.pause();const a=this.sound.add("game-over-sound",{volume:b.getSFXVolume()});a.play(),a.once("complete",()=>{e&&e.resume()}),this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,657935,.9);const i=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-200,"NO CANDY!",{fontFamily:"October Crow, cursive",fontSize:"96px",fill:"#cc0000"});i.setOrigin(.5),i.setShadow(5,5,"#000000",15),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-120,"The kids got no treats...",{fontFamily:"Griffy, cursive",fontSize:"36px",fill:"#888888",fontStyle:"italic"}).setOrigin(.5),this.createCryingKids();const s=this.add.text(this.cameras.main.centerX,this.cameras.main.height-120,"Press SPACE to Try Again",{fontFamily:"Griffy, cursive",fontSize:"36px",fill:"#ff6600",fontStyle:"bold"});s.setOrigin(.5),this.tweens.add({targets:s,alpha:.2,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(this.cameras.main.centerX,this.cameras.main.height-60,"Press M for Menu",{fontFamily:"Griffy, cursive",fontSize:"28px",fill:"#aaaaaa",fontStyle:"bold"}).setOrigin(.5),this.input.keyboard.once("keydown-SPACE",()=>{this.scene.start("GameScene",{level:1,lives:4})}),this.input.keyboard.once("keydown-M",()=>{this.scene.start("MenuScene")})}createCryingKids(){const e=this.cameras.main.centerX,a=this.cameras.main.centerY;[{x:e-250,y:a+50},{x:e,y:a+50},{x:e+250,y:a+50}].forEach((t,s)=>{const n=`chibi-kid-${s+1}`;this.add.image(t.x,t.y,n).setScale(.4)})}}class fe extends l.Scene{constructor(){super({key:"VictoryScene"})}preload(){this.load.image("happy-kid-1","/happy-chibi/chibi_one_happy-removebg-preview.png"),this.load.image("happy-kid-2","/happy-chibi/chibi_two_happy-removebg-preview.png"),this.load.image("happy-kid-3","/happy-chibi/chibi_three_happy-removebg-preview.png")}create(e){const a=e.time||0,i=e.level||1,t=e.lives!==void 0?e.lives:4,s=i+1,n=this.sound.get("bgm");n&&n.isPlaying&&n.pause();const r=this.sound.add("victory-sound",{volume:b.getSFXVolume()});r.play(),r.once("complete",()=>{n&&n.resume()}),this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,657935,.9);const o=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-250,"LEVEL "+i+" COMPLETE!",{fontFamily:"October Crow, cursive",fontSize:"84px",fill:"#00ff00"});o.setOrigin(.5),o.setShadow(5,5,"#000000",15);const y=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-150,"Th-thank you sooo much for the candy!!",{fontFamily:"Griffy, cursive",fontSize:"38px",fill:"#ffaa00",fontStyle:"italic",align:"center"});y.setOrigin(.5),this.tweens.add({targets:y,scale:1.05,duration:800,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.createHappyKids();const h=this.add.text(this.cameras.main.centerX,this.cameras.main.height-120,"Press SPACE for Next Level",{fontFamily:"Griffy, cursive",fontSize:"36px",fill:"#00ff00",fontStyle:"bold"});h.setOrigin(.5),this.tweens.add({targets:h,alpha:.2,duration:600,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.input.keyboard.once("keydown-SPACE",()=>{this.scene.start("GameScene",{level:s,lives:t})}),this.add.text(this.cameras.main.centerX,this.cameras.main.height-60,"Press M for Menu",{fontFamily:"Griffy, cursive",fontSize:"28px",fill:"#aaaaaa",fontStyle:"bold"}).setOrigin(.5),this.saveCompletion(a,i),this.input.keyboard.once("keydown-M",()=>{this.scene.start("MenuScene")})}createHappyKids(){const e=this.cameras.main.centerX,a=this.cameras.main.centerY;[{x:e-250,y:a+50},{x:e,y:a+50},{x:e+250,y:a+50}].forEach((t,s)=>{const n=`happy-kid-${s+1}`;this.add.image(t.x,t.y,n).setScale(.4),this.createSparkles(t.x,t.y-80,s)})}createSparkles(e,a,i){this.time.addEvent({delay:300+i*150,callback:()=>{const t=e+(Math.random()-.5)*60,s=a+(Math.random()-.5)*60,n=this.add.circle(t,s,5,16776960,.9);this.tweens.add({targets:n,alpha:0,scale:0,duration:800,ease:"Sine.easeOut",onComplete:()=>n.destroy()})},loop:!0})}saveCompletion(e,a){const i=`bestTime_level${a}`,t=localStorage.getItem(i);(!t||e<parseInt(t))&&localStorage.setItem(i,e.toString())}}class pe extends l.Scene{constructor(){super({key:"RespawnScene"})}preload(){this.load.image("cheer-1","/cheer-chibi/cheering_chibi-removebg-preview.png"),this.load.image("cheer-2","/cheer-chibi/cheering_level_2_chibi-removebg-preview.png"),this.load.image("cheer-3","/cheer-chibi/cheering_level_3_chibi-removebg-preview.png")}create(e){const a=e.livesLost||1,i=e.livesRemaining||2;this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,657935,.95);let t,s;a===1?(t="cheer-1",s="Fight on, you can do it!"):a===2?(t="cheer-2",s="Don't give up, Player!"):(t="cheer-3",s="I want candies, so fight Player!");const n=this.add.image(this.cameras.main.centerX,this.cameras.main.centerY-50,t);n.setScale(.5),this.tweens.add({targets:n,y:n.y-20,duration:500,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+150,s,{fontFamily:"October Crow, cursive",fontSize:"42px",fill:"#ffaa00",align:"center"}).setOrigin(.5),this.add.text(this.cameras.main.centerX,this.cameras.main.centerY+220,`Lives Remaining: ${i}`,{fontFamily:"Griffy, cursive",fontSize:"32px",fill:"#ff6600"}).setOrigin(.5);const y=this.add.text(this.cameras.main.centerX,this.cameras.main.height-80,"Respawning...",{fontFamily:"Griffy, cursive",fontSize:"28px",fill:"#888888"});y.setOrigin(.5),this.tweens.add({targets:y,alpha:.3,duration:500,yoyo:!0,repeat:-1}),this.time.delayedCall(2500,()=>{const h=this.scene.get("GameScene");h&&h.respawnPlayer&&h.respawnPlayer(),this.scene.stop("RespawnScene"),this.scene.resume("GameScene")})}}class ue extends l.Scene{constructor(){super({key:"PauseScene"})}create(e){e.level,e.lives,this.add.rectangle(this.cameras.main.centerX,this.cameras.main.centerY,this.cameras.main.width,this.cameras.main.height,0,.7).setScrollFactor(0);const i=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-150,"PAUSED",{fontFamily:"October Crow, cursive",fontSize:"84px",fill:"#ffaa00"});i.setOrigin(.5),i.setShadow(5,5,"#000000",15),this.createButton(this.cameras.main.centerX,this.cameras.main.centerY-20,"Resume (ESC)",()=>{this.scene.resume("GameScene"),this.scene.stop("PauseScene")}),this.createButton(this.cameras.main.centerX,this.cameras.main.centerY+60,"Restart Level",()=>{this.scene.stop(),this.scene.stop("GameScene"),this.scene.start("GameScene",{level:1,lives:4})}),this.createButton(this.cameras.main.centerX,this.cameras.main.centerY+140,"Main Menu",()=>{this.scene.stop(),this.scene.stop("GameScene"),this.scene.start("MenuScene")}),this.input.keyboard.once("keydown-ESC",()=>{this.scene.resume("GameScene"),this.scene.stop("PauseScene")})}createButton(e,a,i,t){const s=this.add.text(e,a,i,{fontFamily:"Griffy, cursive",fontSize:"36px",fill:"#ffffff",fontStyle:"bold",backgroundColor:"#333333",padding:{x:30,y:15}});return s.setOrigin(.5),s.setInteractive({useHandCursor:!0}),s.on("pointerover",()=>{s.setStyle({fill:"#ffaa00"}),s.setScale(1.05)}),s.on("pointerout",()=>{s.setStyle({fill:"#ffffff"}),s.setScale(1)}),s.on("pointerdown",t),s}}const ge={...q,scene:[ee,te,ie,Z,se,de,pe,ue,ye,fe]};new l.Game(ge);
